version: '3.8'
services:
  nest-auth-db:
    image: postgres:15
    container_name: nest-auth-db-container
    restart: always
    env_file:
      - .env
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    ports:
      - '${POSTGRES_PORT}:5432'
    volumes:
      - nest-auth-db-data:/var/lib/postgresql/data
    networks:
      - nest-auth-network

  nest-auth-srv:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: nest-auth-srv-container
    env_file:
      - .env
    ports:
      - '${HTTP_PORT}:${HTTP_PORT}'
    environment:
      NODE_ENV: local
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
      APP_NAME: ${APP_NAME}
      APP_ENV: ${APP_ENV}
      APP_LANGUAGE: ${APP_LANGUAGE}
      APP_TIMEZONE: ${APP_TIMEZONE}
      GRPC_HOST: ${GRPC_HOST}
      GRPC_PORT: ${GRPC_PORT}
      HTTP_HOST: ${HTTP_HOST}
      HTTP_PORT: ${HTTP_PORT}
      URL_VERSIONING_ENABLE: ${URL_VERSIONING_ENABLE}
      URL_VERSION: ${URL_VERSION}
    networks:
      - nest-auth-network

volumes:
  nest-auth-db-data:

networks:
  nest-auth-network:
    driver: bridge
